var Controller,Router;Controller=function(){function e(e,t){this.name=e!=null?e:"base_controller",this.methods=t!=null?t:{},this.view_data={},this.setup()}return e.prototype.setup=function(){var e,t,n,r;this.method_names=[],n=this.methods,r=[];for(e in n)t=n[e],r.push(this.method_names.push(e));return r},e.prototype.template_name=function(e){return""+this.name+"_"+e+"_template"},e.prototype.data=function(e,t){var n,r;t==null&&(t=null);if(typeof e=="object")for(n in e)r=e[n],this.view_data[n]=r;else this.view_data[e]=t;return this.view_data},e.prototype.update_page_meta=function(){if(this.view_data.title!=null)return $("title").text(this.view_data.title)},e.prototype.render=function(e){var t,n;return e==null&&(e=".body"),this.current_method?(t=$(e),n=$("#"+this.template_name(this.current_method_name)),this.update_page_meta(),t.length?n.length?(t.empty(),t.html(Mustache.render(n.html(),this.view_data))):console.error("template not found"):console.error("target not found")):console.error("controller render called without method setup! should be invoked by router")},e.prototype._handle=function(e,t){return t==null&&(t={}),this.methods.hasOwnProperty(e)?(console.log(""+this.name+" controller rendering route: "+e),this.current_method=this.methods[e],this.current_method_name=e,typeof this.current_method=="function"?this.current_method.call(this,t):typeof this.current_method=="string"?require([this.current_method],function(e){return function(n){return e.current_method=n,e.current_method.call(e,t)}}(this)):(console.error("route '"+e+"' doesnt seem set up properly"),!1)):console.error("unhandled route for "+this.name+" controller: "+e)},e}(),Router=function(){function e(e){this.routes=e!=null?e:{},this.setup_routes(),this.setup_events()}return e.prototype.init=function(){return this.handle_route(this.current_path())},e.prototype.setup_routes=function(){},e.prototype.setup_events=function(){return window.addEventListener("hashchange",function(e){return function(t){return e.handle_route(e.current_path())}}(this))},e.prototype.current_path=function(){return"/"+window.location.hash.replace("#","")},e.prototype.path_pieces=function(){return this.current_path.split("/")},e.prototype.handle_route=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;t=!1,a={},c=this.routes;for(r in c){u=c[r];if(!t&&u.path.indexOf(":")<0&&u.path===e){t=u;break}}if(!t){h=this.routes;for(r in h){u=h[r];if(!t&&u.path.indexOf(":")>0){o=u.path.split(":"),i=e.split("/");if(e.indexOf(o[0])===0){t=u;for(n=f=0,l=o.length;f<l;n=++f)s=o[n],n>0&&(a[s]=i[n]);break}}console.log(a)}if(!t){console.error("routing error for '"+e+"'; no handler found");if(!this.routes.hasOwnProperty("*"))return;t=this.routes["*"]}}return t.controller._handle(t.name,a)},e.prototype.get_route=function(e,t){var n,r,i;t==null&&(t={});if(!this.routes.hasOwnProperty(e))return console.error("no route found with name: "+e);r=this.routes[e].path;for(n in t)i=t[n],r.replace(new RegExp(":"+n,"g"),i);return r},e}();