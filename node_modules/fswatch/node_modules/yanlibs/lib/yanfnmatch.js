// Let's try to provide something like fnmatch from Python.
// Some parts of code are ported to Javascript from:
// * http://svn.python.org/view/python/branches/release27-maint/Lib/fnmatch.py

exports.translate = function(pat) {
    var i = 0, j = 0, n = pat.length, res = '', ci, cj;

    while (i < n) {
        ci = pat.charAt(i);
        cj = pat.charAt(j);
        i++;
        if (ci === '*') res = res + '.*';
        else if (ci === '?') res = res + '.';
        else if (ci === '[') {
            j = i;
            if (j < n && (cj === '!' || cj === ']')) j++;
            while (j < n && cj !== ']') j++;
            if (j >= n) res = res + '\\[';
            else {
                stuff = pat.substring(i, j).replace('\\','\\\\');
                i = j + 1;
                if (stuff.charAt(0) === '!') {
                    stuff = '^' + stuff.substring(1, stuff.length);
                } else if (stuff.charAt(0) === '^') {
                    stuff = '\\' + stuff;
                    res = res + '[' + stuff + ']';
                }
            }
        } else res = res + escape(ci);
    }

    return res;
};

function escape(c) {
    // very dummy, TODO: do it smarter
    return /[0-9a-zA-Z]/.test(c) ? c : '\\' + c;
}